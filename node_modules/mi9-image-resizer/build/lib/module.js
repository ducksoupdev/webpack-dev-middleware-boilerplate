module.exports =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/*!**********************************!*\
  !*** ./src/scripts/index.coffee ***!
  \**********************************/
/***/ function(module, exports, __webpack_require__) {

	module.exports = __webpack_require__(/*! ./image-resizer */ 1);


/***/ },
/* 1 */
/*!******************************************!*\
  !*** ./src/scripts/image-resizer.coffee ***!
  \******************************************/
/***/ function(module, exports, __webpack_require__) {

	var AWS, ImageResizer, Thumbor, _, q,
	  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };
	
	q = __webpack_require__(/*! q */ 2);
	
	_ = __webpack_require__(/*! lodash */ 3);
	
	AWS = __webpack_require__(/*! aws-sdk */ 4);
	
	Thumbor = __webpack_require__(/*! thumbor */ 5);
	
	ImageResizer = (function() {
	  var instance;
	
	  instance = null;
	
	  ImageResizer.templates = {
	    imageResizer: __webpack_require__(/*! ../templates/image-resizer */ 6)
	  };
	
	  ImageResizer.create = function(params) {
	    if (instance) {
	      return instance;
	    }
	    return instance = new ImageResizer(params);
	  };
	
	  ImageResizer.instance = function() {
	    if (instance) {
	      return instance;
	    }
	    throw new Error('ImageResizer needs to be instantiated');
	  };
	
	  function ImageResizer(params) {
	    this.middleware = bind(this.middleware, this);
	    this.cachedSigningKey = null;
	    this.cachedSigningKeyTime = null;
	    this.Thumbor = Thumbor;
	    this.settings = params;
	  }
	
	  ImageResizer.prototype.middleware = function(req, res, next) {
	    return this.fetchSigningKey()["catch"](function(e) {
	      return console.log('Failed to fetch Image Resizer Signing Key', e);
	    }).done(function() {
	      return next();
	    });
	  };
	
	  ImageResizer.prototype.fetchSigningKey = function() {
	    var currentTime, deferred, deltaTime;
	    currentTime = (new Date()).getTime();
	    if (this.settings.signing.enabled) {
	      deltaTime = currentTime - this.cachedSigningKeyTime;
	      if (this.cachedSigningKeyTime === null || deltaTime > this.settings.signing.lifetime) {
	        this.cachedSigningKeyTime = currentTime;
	        deferred = q.defer();
	        this.getBucketContent(this.settings.signing.region, this.settings.signing.bucketName, this.settings.signing.key).done((function(_this) {
	          return function(key) {
	            if (key) {
	              _this.cachedSigningKey = key;
	            }
	            return deferred.resolve(_this.cachedSigningKey);
	          };
	        })(this), (function(_this) {
	          return function(e) {
	            _this.cachedSigningKeyTime = null;
	            return deferred.reject(e);
	          };
	        })(this));
	        if (!this.cachedSigningKey) {
	          return deferred.promise;
	        }
	      }
	    }
	    return q(this.cachedSigningKey);
	  };
	
	  ImageResizer.prototype.getSigningKey = function() {
	    if (this.settings.signing.enabled) {
	      if (this.cachedSigningKey) {
	        return this.cachedSigningKey;
	      } else {
	        throw new Error('Signing is required but no signing key available');
	      }
	    } else {
	      return null;
	    }
	  };
	
	  ImageResizer.prototype.getBucketContent = function(region, bucket, key) {
	    var deferred, s3;
	    deferred = q.defer();
	    s3 = new AWS.S3({
	      region: region
	    });
	    s3.getObject({
	      Bucket: bucket,
	      Key: key
	    }, function(err, data) {
	      if (err) {
	        console.log("Failed to retrieve " + bucket + "/" + key + " from S3", err);
	        return deferred.reject(err);
	      } else {
	        return deferred.resolve(data != null ? data.Body : void 0);
	      }
	    });
	    return deferred.promise;
	  };
	
	  ImageResizer.prototype.getDefaultOptions = function() {
	    return {
	      width: 0,
	      height: 0
	    };
	  };
	
	  ImageResizer.prototype.getResizedImageUrl = function(source, options) {
	    var e, encodedSource, filters, key, thumbor;
	    if (source) {
	      try {
	        encodedSource = encodeURIComponent(decodeURIComponent(source));
	        key = this.getSigningKey();
	        options = _.merge({}, this.getDefaultOptions(), options);
	        thumbor = new this.Thumbor(key, this.settings.baseUrl);
	        thumbor.setImagePath(encodedSource).resize(options.width, options.height);
	        filters = _.merge(this.settings.filters, options.filters);
	        return this.applyFilters(thumbor, filters).buildUrl();
	      } catch (_error) {
	        e = _error;
	        console.log('Failed to generate thumbor url', e);
	        return source;
	      }
	    } else {
	      return null;
	    }
	  };
	
	  ImageResizer.prototype.applyFilters = function(thumbor, filters) {
	    var ref, ref1;
	    thumbor.smartCrop(filters.smart);
	    if ((ref = filters.align) != null ? ref.horizontal : void 0) {
	      thumbor.halign(filters.align.horizontal);
	    }
	    if ((ref1 = filters.align) != null ? ref1.vertical : void 0) {
	      thumbor.valign(filters.align.vertical);
	    }
	    return thumbor;
	  };
	
	  ImageResizer.prototype.getResizedImageSet = function(source, options, aspect) {
	    var imageSetSizes;
	    if (source) {
	      imageSetSizes = this.getResizedImageSetSizes(options);
	      return imageSetSizes.map((function(_this) {
	        return function(item) {
	          if (item != null) {
	            item.height = aspect ? Math.round((item != null ? item.width : void 0) / aspect) : 0;
	          }
	          options = _.merge({}, options, item);
	          return {
	            size: {
	              width: item != null ? item.width : void 0
	            },
	            src: _this.getResizedImageUrl(source, options)
	          };
	        };
	      })(this));
	    } else {
	      return [];
	    }
	  };
	
	  ImageResizer.prototype.getResizedImageSetSizes = function(options) {
	    var i, imageSetSizes, len, ref, size;
	    imageSetSizes = [];
	    if (options && options.width) {
	      ref = this.settings.imageSet.sizes;
	      for (i = 0, len = ref.length; i < len; i++) {
	        size = ref[i];
	        imageSetSizes.push(size);
	        if (size.width > options.width) {
	          break;
	        }
	      }
	    } else {
	      imageSetSizes = this.settings.imageSet.sizes;
	    }
	    return imageSetSizes;
	  };
	
	  return ImageResizer;
	
	})();
	
	module.exports = ImageResizer;


/***/ },
/* 2 */
/*!********************!*\
  !*** external "q" ***!
  \********************/
/***/ function(module, exports) {

	module.exports = require("q");

/***/ },
/* 3 */
/*!*************************!*\
  !*** external "lodash" ***!
  \*************************/
/***/ function(module, exports) {

	module.exports = require("lodash");

/***/ },
/* 4 */
/*!**************************!*\
  !*** external "aws-sdk" ***!
  \**************************/
/***/ function(module, exports) {

	module.exports = require("aws-sdk");

/***/ },
/* 5 */
/*!**************************!*\
  !*** external "thumbor" ***!
  \**************************/
/***/ function(module, exports) {

	module.exports = require("thumbor");

/***/ },
/* 6 */
/*!******************************************!*\
  !*** ./src/templates/image-resizer.jade ***!
  \******************************************/
/***/ function(module, exports, __webpack_require__) {

	var jade = __webpack_require__(/*! ./~/jade/lib/runtime.js */ 7);
	
	module.exports = function template(locals) {
	var buf = [];
	var jade_mixins = {};
	var jade_interp;
	;var locals_for_with = (locals || {});(function (model) {
	if ( model.url)
	{
	var alt = model.alt;
	var width = model.width;
	var height = model.height;
	var aspect = model.width / model.height;
	var padding = model.height / model.width * 100;
	var url = model.url;
	var urlSet = model.urlSet;
	buf.push("<figure" + (jade.attr("style", width ? "padding-top: " + (padding) + "%" : false, true, false)) + (jade.cls([['image-resizer', width ? 'image-resizer--placeholder' : '']], [true])) + "><img" + (jade.attr("alt", alt, true, false)) + " src=\"http://9news.static9.net.au/Content/images/1x1.gif\" data-image-resizer=\"data-image-resizer\"" + (jade.attr("data-src-set", urlSet, true, false)) + (jade.attr("data-aspect", aspect, true, false)) + " class=\"image-resizer__image\"/><noscript><div class=\"image-resizer--nojs\"><img" + (jade.attr("alt", alt, true, false)) + (jade.attr("src", url, true, false)) + " data-image-resizer=\"data-image-resizer\" class=\"image-resizer__image image-resizer__image--nojs\"/></div></noscript></figure>");
	}}.call(this,"model" in locals_for_with?locals_for_with.model:typeof model!=="undefined"?model:undefined));;return buf.join("");
	}

/***/ },
/* 7 */
/*!*******************************!*\
  !*** ./~/jade/lib/runtime.js ***!
  \*******************************/
/***/ function(module, exports, __webpack_require__) {

	'use strict';
	
	/**
	 * Merge two attribute objects giving precedence
	 * to values in object `b`. Classes are special-cased
	 * allowing for arrays and merging/joining appropriately
	 * resulting in a string.
	 *
	 * @param {Object} a
	 * @param {Object} b
	 * @return {Object} a
	 * @api private
	 */
	
	exports.merge = function merge(a, b) {
	  if (arguments.length === 1) {
	    var attrs = a[0];
	    for (var i = 1; i < a.length; i++) {
	      attrs = merge(attrs, a[i]);
	    }
	    return attrs;
	  }
	  var ac = a['class'];
	  var bc = b['class'];
	
	  if (ac || bc) {
	    ac = ac || [];
	    bc = bc || [];
	    if (!Array.isArray(ac)) ac = [ac];
	    if (!Array.isArray(bc)) bc = [bc];
	    a['class'] = ac.concat(bc).filter(nulls);
	  }
	
	  for (var key in b) {
	    if (key != 'class') {
	      a[key] = b[key];
	    }
	  }
	
	  return a;
	};
	
	/**
	 * Filter null `val`s.
	 *
	 * @param {*} val
	 * @return {Boolean}
	 * @api private
	 */
	
	function nulls(val) {
	  return val != null && val !== '';
	}
	
	/**
	 * join array as classes.
	 *
	 * @param {*} val
	 * @return {String}
	 */
	exports.joinClasses = joinClasses;
	function joinClasses(val) {
	  return (Array.isArray(val) ? val.map(joinClasses) :
	    (val && typeof val === 'object') ? Object.keys(val).filter(function (key) { return val[key]; }) :
	    [val]).filter(nulls).join(' ');
	}
	
	/**
	 * Render the given classes.
	 *
	 * @param {Array} classes
	 * @param {Array.<Boolean>} escaped
	 * @return {String}
	 */
	exports.cls = function cls(classes, escaped) {
	  var buf = [];
	  for (var i = 0; i < classes.length; i++) {
	    if (escaped && escaped[i]) {
	      buf.push(exports.escape(joinClasses([classes[i]])));
	    } else {
	      buf.push(joinClasses(classes[i]));
	    }
	  }
	  var text = joinClasses(buf);
	  if (text.length) {
	    return ' class="' + text + '"';
	  } else {
	    return '';
	  }
	};
	
	
	exports.style = function (val) {
	  if (val && typeof val === 'object') {
	    return Object.keys(val).map(function (style) {
	      return style + ':' + val[style];
	    }).join(';');
	  } else {
	    return val;
	  }
	};
	/**
	 * Render the given attribute.
	 *
	 * @param {String} key
	 * @param {String} val
	 * @param {Boolean} escaped
	 * @param {Boolean} terse
	 * @return {String}
	 */
	exports.attr = function attr(key, val, escaped, terse) {
	  if (key === 'style') {
	    val = exports.style(val);
	  }
	  if ('boolean' == typeof val || null == val) {
	    if (val) {
	      return ' ' + (terse ? key : key + '="' + key + '"');
	    } else {
	      return '';
	    }
	  } else if (0 == key.indexOf('data') && 'string' != typeof val) {
	    if (JSON.stringify(val).indexOf('&') !== -1) {
	      console.warn('Since Jade 2.0.0, ampersands (`&`) in data attributes ' +
	                   'will be escaped to `&amp;`');
	    };
	    if (val && typeof val.toISOString === 'function') {
	      console.warn('Jade will eliminate the double quotes around dates in ' +
	                   'ISO form after 2.0.0');
	    }
	    return ' ' + key + "='" + JSON.stringify(val).replace(/'/g, '&apos;') + "'";
	  } else if (escaped) {
	    if (val && typeof val.toISOString === 'function') {
	      console.warn('Jade will stringify dates in ISO form after 2.0.0');
	    }
	    return ' ' + key + '="' + exports.escape(val) + '"';
	  } else {
	    if (val && typeof val.toISOString === 'function') {
	      console.warn('Jade will stringify dates in ISO form after 2.0.0');
	    }
	    return ' ' + key + '="' + val + '"';
	  }
	};
	
	/**
	 * Render the given attributes object.
	 *
	 * @param {Object} obj
	 * @param {Object} escaped
	 * @return {String}
	 */
	exports.attrs = function attrs(obj, terse){
	  var buf = [];
	
	  var keys = Object.keys(obj);
	
	  if (keys.length) {
	    for (var i = 0; i < keys.length; ++i) {
	      var key = keys[i]
	        , val = obj[key];
	
	      if ('class' == key) {
	        if (val = joinClasses(val)) {
	          buf.push(' ' + key + '="' + val + '"');
	        }
	      } else {
	        buf.push(exports.attr(key, val, false, terse));
	      }
	    }
	  }
	
	  return buf.join('');
	};
	
	/**
	 * Escape the given string of `html`.
	 *
	 * @param {String} html
	 * @return {String}
	 * @api private
	 */
	
	var jade_encode_html_rules = {
	  '&': '&amp;',
	  '<': '&lt;',
	  '>': '&gt;',
	  '"': '&quot;'
	};
	var jade_match_html = /[&<>"]/g;
	
	function jade_encode_char(c) {
	  return jade_encode_html_rules[c] || c;
	}
	
	exports.escape = jade_escape;
	function jade_escape(html){
	  var result = String(html).replace(jade_match_html, jade_encode_char);
	  if (result === '' + html) return html;
	  else return result;
	};
	
	/**
	 * Re-throw the given `err` in context to the
	 * the jade in `filename` at the given `lineno`.
	 *
	 * @param {Error} err
	 * @param {String} filename
	 * @param {String} lineno
	 * @api private
	 */
	
	exports.rethrow = function rethrow(err, filename, lineno, str){
	  if (!(err instanceof Error)) throw err;
	  if ((typeof window != 'undefined' || !filename) && !str) {
	    err.message += ' on line ' + lineno;
	    throw err;
	  }
	  try {
	    str = str || __webpack_require__(/*! fs */ 8).readFileSync(filename, 'utf8')
	  } catch (ex) {
	    rethrow(err, null, lineno)
	  }
	  var context = 3
	    , lines = str.split('\n')
	    , start = Math.max(lineno - context, 0)
	    , end = Math.min(lines.length, lineno + context);
	
	  // Error context
	  var context = lines.slice(start, end).map(function(line, i){
	    var curr = i + start + 1;
	    return (curr == lineno ? '  > ' : '    ')
	      + curr
	      + '| '
	      + line;
	  }).join('\n');
	
	  // Alter exception message
	  err.path = filename;
	  err.message = (filename || 'Jade') + ':' + lineno
	    + '\n' + context + '\n\n' + err.message;
	  throw err;
	};
	
	exports.DebugItem = function DebugItem(lineno, filename) {
	  this.lineno = lineno;
	  this.filename = filename;
	}


/***/ },
/* 8 */
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ function(module, exports) {

	module.exports = require("fs");

/***/ }
/******/ ]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vbm9kZV9tb2R1bGVzL21pOS1pbWFnZS1yZXNpemVyL3dlYnBhY2svYm9vdHN0cmFwIDU0MmZmOGE1YjUxZjk0NTllMTllIiwid2VicGFjazovLy9ub2RlX21vZHVsZXMvbWk5LWltYWdlLXJlc2l6ZXIvLi9zcmMvc2NyaXB0cy9pbmRleC5jb2ZmZWUiLCJ3ZWJwYWNrOi8vL25vZGVfbW9kdWxlcy9taTktaW1hZ2UtcmVzaXplci8uL3NyYy9zY3JpcHRzL2ltYWdlLXJlc2l6ZXIuY29mZmVlIiwid2VicGFjazovLy9ub2RlX21vZHVsZXMvbWk5LWltYWdlLXJlc2l6ZXIvZXh0ZXJuYWwgXCJxXCIiLCJ3ZWJwYWNrOi8vL25vZGVfbW9kdWxlcy9taTktaW1hZ2UtcmVzaXplci9leHRlcm5hbCBcImxvZGFzaFwiIiwid2VicGFjazovLy9ub2RlX21vZHVsZXMvbWk5LWltYWdlLXJlc2l6ZXIvZXh0ZXJuYWwgXCJhd3Mtc2RrXCIiLCJ3ZWJwYWNrOi8vL25vZGVfbW9kdWxlcy9taTktaW1hZ2UtcmVzaXplci9leHRlcm5hbCBcInRodW1ib3JcIiIsIndlYnBhY2s6Ly8vbm9kZV9tb2R1bGVzL21pOS1pbWFnZS1yZXNpemVyLy4vc3JjL3RlbXBsYXRlcy9pbWFnZS1yZXNpemVyLmphZGUiLCJ3ZWJwYWNrOi8vL25vZGVfbW9kdWxlcy9taTktaW1hZ2UtcmVzaXplci8uL34vamFkZS9saWIvcnVudGltZS5qcyIsIndlYnBhY2s6Ly8vbm9kZV9tb2R1bGVzL21pOS1pbWFnZS1yZXNpemVyL2V4dGVybmFsIFwiZnNcIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVCQUFlO0FBQ2Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7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QUFDQTtBQUNBLE1BQUs7QUFDTDtBQUNBO0FBQ0EsSUFBRztBQUNIO0FBQ0E7QUFDQSw4Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdFQUF1RTtBQUN2RSxJQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFlBQVcsT0FBTztBQUNsQixZQUFXLE9BQU87QUFDbEIsYUFBWTtBQUNaO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLG9CQUFtQixpQkFBaUI7QUFDcEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFlBQVcsT0FBTztBQUNsQixhQUFZO0FBQ1o7QUFDQTs7QUFFQTtBQUNBLGNBQWE7QUFDYixhQUFZO0FBQ1osYUFBWTtBQUNaLGVBQWM7QUFDZDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFXLE1BQU07QUFDakIsWUFBVyxPQUFPO0FBQ2xCLFlBQVcsT0FBTztBQUNsQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUNyUEEsZ0MiLCJmaWxlIjoibGliL21vZHVsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKVxuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRleHBvcnRzOiB7fSxcbiBcdFx0XHRpZDogbW9kdWxlSWQsXG4gXHRcdFx0bG9hZGVkOiBmYWxzZVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogd2VicGFjay9ib290c3RyYXAgNTQyZmY4YTViNTFmOTQ1OWUxOWVcbiAqKi8iLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUgJy4vaW1hZ2UtcmVzaXplcidcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL34vY29mZmVlbGludC1sb2FkZXIhLi9zcmMvc2NyaXB0cy9pbmRleC5jb2ZmZWVcbiAqKi8iLCJxICAgICAgICAgICAgICAgPSByZXF1aXJlICdxJ1xuXyAgICAgICAgICAgICAgID0gcmVxdWlyZSAnbG9kYXNoJ1xuQVdTICAgICAgICAgICAgID0gcmVxdWlyZSAnYXdzLXNkaydcblRodW1ib3IgICAgICAgICA9IHJlcXVpcmUgJ3RodW1ib3InXG5cbmNsYXNzIEltYWdlUmVzaXplclxuXG4gICAgIyMjI1xuICAgICMgQHBhcmFtczogY29uZmlnIG9iamVjdFxuICAgICMgICBpbWFnZVJlc2l6ZXI6XG4gICAgIyAgICAgICBiYXNlVXJsOiBCYXNlIHVybCBmb3IgaW1hZ2VzXG4gICAgIyAgICAgICBzaWduaW5nOlxuICAgICMgICAgICAgICAgIGxpZmV0aW1lOiBLZXkgbGlmZSBpbiBtaWxsaXNlY29uZHNcbiAgICAjICAgICAgICAgICByZWdpb246IEFXUyBSZWdpb25cbiAgICAjICAgICAgICAgICBidWNrZXROYW1lOiBTMyBidWNrZXQgbmFtZVxuICAgICMgICAgICAgICAgIGtleTogUzMga2V5XG4gICAgIyAgICAgICAgICAgZW5hYmxlZDogYm9vbGVhblxuICAgICMgICAgICAgZmlsdGVyczpcbiAgICAjICAgICAgICAgICBzbWFydDogYm9vbGVhblxuICAgICMgICAgICAgaW1hZ2VTZXQ6XG4gICAgIyAgICAgICAgICAgc2l6ZXM6IEFycmF5XG4gICAgIyMjI1xuXG4gICAgaW5zdGFuY2UgPSBudWxsXG5cbiAgICBAdGVtcGxhdGVzOlxuICAgICAgICBpbWFnZVJlc2l6ZXI6IHJlcXVpcmUgJy4uL3RlbXBsYXRlcy9pbWFnZS1yZXNpemVyJ1xuXG4gICAgQGNyZWF0ZTogKHBhcmFtcykgLT5cbiAgICAgICAgcmV0dXJuIGluc3RhbmNlIGlmIGluc3RhbmNlXG4gICAgICAgIGluc3RhbmNlID0gbmV3IEltYWdlUmVzaXplcihwYXJhbXMpXG5cbiAgICBAaW5zdGFuY2U6IC0+XG4gICAgICAgIHJldHVybiBpbnN0YW5jZSBpZiBpbnN0YW5jZVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IgJ0ltYWdlUmVzaXplciBuZWVkcyB0byBiZSBpbnN0YW50aWF0ZWQnXG5cbiAgICBjb25zdHJ1Y3RvcjogKHBhcmFtcykgLT5cbiAgICAgICAgQGNhY2hlZFNpZ25pbmdLZXkgPSBudWxsXG4gICAgICAgIEBjYWNoZWRTaWduaW5nS2V5VGltZSA9IG51bGxcbiAgICAgICAgQFRodW1ib3IgPSBUaHVtYm9yXG4gICAgICAgIEBzZXR0aW5ncyA9IHBhcmFtc1xuXG4gICAgbWlkZGxld2FyZTogKHJlcSwgcmVzLCBuZXh0KSA9PlxuICAgICAgICBAZmV0Y2hTaWduaW5nS2V5KClcbiAgICAgICAgLmNhdGNoIChlKSAtPiBjb25zb2xlLmxvZyAnRmFpbGVkIHRvIGZldGNoIEltYWdlIFJlc2l6ZXIgU2lnbmluZyBLZXknLCBlXG4gICAgICAgIC5kb25lIC0+IG5leHQoKVxuXG4gICAgZmV0Y2hTaWduaW5nS2V5OiAtPlxuICAgICAgICBjdXJyZW50VGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKClcbiAgICAgICAgaWYgQHNldHRpbmdzLnNpZ25pbmcuZW5hYmxlZFxuICAgICAgICAgICAgI09ubHkgdXBkYXRlIGtleSBpZiBrZXkgbGlmZXRpbWUgaGFzIGV4cGlyZWRcbiAgICAgICAgICAgIGRlbHRhVGltZSA9IGN1cnJlbnRUaW1lIC0gQGNhY2hlZFNpZ25pbmdLZXlUaW1lXG4gICAgICAgICAgICBpZiBAY2FjaGVkU2lnbmluZ0tleVRpbWUgaXMgbnVsbCBvciBkZWx0YVRpbWUgPiBAc2V0dGluZ3Muc2lnbmluZy5saWZldGltZVxuICAgICAgICAgICAgICAgIEBjYWNoZWRTaWduaW5nS2V5VGltZSA9IGN1cnJlbnRUaW1lXG5cbiAgICAgICAgICAgICAgICBkZWZlcnJlZCA9IHEuZGVmZXIoKVxuICAgICAgICAgICAgICAgIEBnZXRCdWNrZXRDb250ZW50IEBzZXR0aW5ncy5zaWduaW5nLnJlZ2lvbiwgQHNldHRpbmdzLnNpZ25pbmcuYnVja2V0TmFtZSwgQHNldHRpbmdzLnNpZ25pbmcua2V5XG4gICAgICAgICAgICAgICAgLmRvbmUoXG4gICAgICAgICAgICAgICAgICAgIChrZXkpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICBAY2FjaGVkU2lnbmluZ0tleSA9IGtleSBpZiBrZXlcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUgQGNhY2hlZFNpZ25pbmdLZXlcbiAgICAgICAgICAgICAgICAgICAgKGUpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAjRXhwaXJlIGNhY2hlIGlmIGVycm9yIG9jY3Vyc1xuICAgICAgICAgICAgICAgICAgICAgICAgQGNhY2hlZFNpZ25pbmdLZXlUaW1lID0gbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0IGVcbiAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAjIElmIHdlIGRvbid0IGhhdmUgYSBjYWNoZWQga2V5IHRoZW4gd2FpdCBmb3Iga2V5IGZyb20gczNyZXBvc2l0b3J5XG4gICAgICAgICAgICAgICAgIyBPdGhlcndpc2UganVzdCByZXR1cm4gc3RhbGUga2V5IGFuZCB1cGRhdGUgY2FjaGVkIGtleSBpbiBiYWNrZ3JvdW5kXG4gICAgICAgICAgICAgICAgdW5sZXNzIEBjYWNoZWRTaWduaW5nS2V5XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlXG4gICAgICAgIHEgQGNhY2hlZFNpZ25pbmdLZXlcblxuICAgIGdldFNpZ25pbmdLZXk6IC0+XG4gICAgICAgIGlmIEBzZXR0aW5ncy5zaWduaW5nLmVuYWJsZWRcbiAgICAgICAgICAgIGlmIEBjYWNoZWRTaWduaW5nS2V5XG4gICAgICAgICAgICAgICAgQGNhY2hlZFNpZ25pbmdLZXlcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IgJ1NpZ25pbmcgaXMgcmVxdWlyZWQgYnV0IG5vIHNpZ25pbmcga2V5IGF2YWlsYWJsZSdcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbnVsbFxuXG4gICAgZ2V0QnVja2V0Q29udGVudDogKHJlZ2lvbiwgYnVja2V0LCBrZXkpIC0+XG4gICAgICAgIGRlZmVycmVkID0gcS5kZWZlcigpXG4gICAgICAgIHMzID0gbmV3IEFXUy5TM1xuICAgICAgICAgICAgcmVnaW9uOiByZWdpb25cblxuICAgICAgICBzMy5nZXRPYmplY3RcbiAgICAgICAgICAgIEJ1Y2tldDogYnVja2V0XG4gICAgICAgICAgICBLZXk6IGtleVxuICAgICAgICAgICAgKGVyciwgZGF0YSkgLT5cbiAgICAgICAgICAgICAgICBpZiBlcnJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cgXCJGYWlsZWQgdG8gcmV0cmlldmUgI3tidWNrZXR9LyN7a2V5fSBmcm9tIFMzXCIsIGVyclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QgZXJyXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlIGRhdGE/LkJvZHlcbiAgICAgICAgZGVmZXJyZWQucHJvbWlzZVxuXG4gICAgZ2V0RGVmYXVsdE9wdGlvbnM6IC0+XG4gICAgICAgIHdpZHRoOiAwXG4gICAgICAgIGhlaWdodDogMFxuXG4gICAgZ2V0UmVzaXplZEltYWdlVXJsOiAoc291cmNlLCBvcHRpb25zKSAtPlxuICAgICAgICBpZiBzb3VyY2VcbiAgICAgICAgICAgIHRyeVxuICAgICAgICAgICAgICAgICNlbmNvZGUgaW1hZ2Ugc291cmNlIHJlcXVpcmVkIGZvciBBa2FtYWkgKHN1cGVyIHdlaXJkKVxuICAgICAgICAgICAgICAgIGVuY29kZWRTb3VyY2UgPSBlbmNvZGVVUklDb21wb25lbnQgZGVjb2RlVVJJQ29tcG9uZW50IHNvdXJjZVxuICAgICAgICAgICAgICAgIGtleSA9IEBnZXRTaWduaW5nS2V5KClcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gXy5tZXJnZSB7fSwgQGdldERlZmF1bHRPcHRpb25zKCksIG9wdGlvbnNcbiAgICAgICAgICAgICAgICB0aHVtYm9yID0gbmV3IEBUaHVtYm9yIGtleSwgQHNldHRpbmdzLmJhc2VVcmxcbiAgICAgICAgICAgICAgICB0aHVtYm9yLnNldEltYWdlUGF0aCBlbmNvZGVkU291cmNlXG4gICAgICAgICAgICAgICAgLnJlc2l6ZSBvcHRpb25zLndpZHRoLCBvcHRpb25zLmhlaWdodFxuXG4gICAgICAgICAgICAgICAgZmlsdGVycyA9IF8ubWVyZ2UgQHNldHRpbmdzLmZpbHRlcnMsIG9wdGlvbnMuZmlsdGVyc1xuXG4gICAgICAgICAgICAgICAgQGFwcGx5RmlsdGVycyh0aHVtYm9yLCBmaWx0ZXJzKS5idWlsZFVybCgpXG4gICAgICAgICAgICBjYXRjaCBlXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cgJ0ZhaWxlZCB0byBnZW5lcmF0ZSB0aHVtYm9yIHVybCcsIGVcbiAgICAgICAgICAgICAgICBzb3VyY2VcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbnVsbFxuXG4gICAgYXBwbHlGaWx0ZXJzOiAodGh1bWJvciwgZmlsdGVycykgLT5cbiAgICAgICAgdGh1bWJvci5zbWFydENyb3AgZmlsdGVycy5zbWFydFxuICAgICAgICB0aHVtYm9yLmhhbGlnbiBmaWx0ZXJzLmFsaWduLmhvcml6b250YWwgaWYgZmlsdGVycy5hbGlnbj8uaG9yaXpvbnRhbFxuICAgICAgICB0aHVtYm9yLnZhbGlnbiBmaWx0ZXJzLmFsaWduLnZlcnRpY2FsIGlmIGZpbHRlcnMuYWxpZ24/LnZlcnRpY2FsXG4gICAgICAgIHRodW1ib3JcblxuICAgIGdldFJlc2l6ZWRJbWFnZVNldDogKHNvdXJjZSwgb3B0aW9ucywgYXNwZWN0KSAtPlxuICAgICAgICBpZiBzb3VyY2VcbiAgICAgICAgICAgIGltYWdlU2V0U2l6ZXMgPSBAZ2V0UmVzaXplZEltYWdlU2V0U2l6ZXMgb3B0aW9uc1xuICAgICAgICAgICAgaW1hZ2VTZXRTaXplcy5tYXAgKGl0ZW0pID0+XG4gICAgICAgICAgICAgICAgaXRlbT8uaGVpZ2h0ID0gaWYgYXNwZWN0IHRoZW4gTWF0aC5yb3VuZChpdGVtPy53aWR0aCAvIGFzcGVjdCkgZWxzZSAwXG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IF8ubWVyZ2Uge30sIG9wdGlvbnMsIGl0ZW1cbiAgICAgICAgICAgICAgICBzaXplOlxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogaXRlbT8ud2lkdGhcbiAgICAgICAgICAgICAgICBzcmM6IEBnZXRSZXNpemVkSW1hZ2VVcmwgc291cmNlLCBvcHRpb25zXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIFtdXG5cbiAgICBnZXRSZXNpemVkSW1hZ2VTZXRTaXplczogKG9wdGlvbnMpIC0+XG4gICAgICAgICNpZiB3aWR0aCBpcyBzcGVjaWZpZWQgd2Ugb25seSB3YW50IHRoZSBpbWFnZSBzZXQgd2lkdGhzIHVwIHRvIHRoZSB3aWR0aCBqdXN0IGdyZWF0ZXJcbiAgICAgICAgaW1hZ2VTZXRTaXplcyA9IFtdXG4gICAgICAgIGlmIG9wdGlvbnMgYW5kIG9wdGlvbnMud2lkdGhcbiAgICAgICAgICAgIGZvciBzaXplIGluIEBzZXR0aW5ncy5pbWFnZVNldC5zaXplc1xuICAgICAgICAgICAgICAgIGltYWdlU2V0U2l6ZXMucHVzaCBzaXplXG4gICAgICAgICAgICAgICAgYnJlYWsgaWYgc2l6ZS53aWR0aCA+IG9wdGlvbnMud2lkdGhcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgaW1hZ2VTZXRTaXplcyA9IEBzZXR0aW5ncy5pbWFnZVNldC5zaXplc1xuXG4gICAgICAgIGltYWdlU2V0U2l6ZXNcblxubW9kdWxlLmV4cG9ydHMgPSBJbWFnZVJlc2l6ZXJcblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vfi9jb2ZmZWVsaW50LWxvYWRlciEuL3NyYy9zY3JpcHRzL2ltYWdlLXJlc2l6ZXIuY29mZmVlXG4gKiovIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwicVwiKTtcblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIGV4dGVybmFsIFwicVwiXG4gKiogbW9kdWxlIGlkID0gMlxuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwibG9kYXNoXCIpO1xuXG5cbi8qKioqKioqKioqKioqKioqKlxuICoqIFdFQlBBQ0sgRk9PVEVSXG4gKiogZXh0ZXJuYWwgXCJsb2Rhc2hcIlxuICoqIG1vZHVsZSBpZCA9IDNcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImF3cy1zZGtcIik7XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiBleHRlcm5hbCBcImF3cy1zZGtcIlxuICoqIG1vZHVsZSBpZCA9IDRcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcInRodW1ib3JcIik7XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiBleHRlcm5hbCBcInRodW1ib3JcIlxuICoqIG1vZHVsZSBpZCA9IDVcbiAqKiBtb2R1bGUgY2h1bmtzID0gMFxuICoqLyIsInZhciBqYWRlID0gcmVxdWlyZShcIi9Vc2Vycy9zdGV2ZS9Qcm9qZWN0cy9NaTkvbW9kdWxlcy9taTktaW1hZ2UtcmVzaXplci1zZXJ2ZXIvbm9kZV9tb2R1bGVzL2phZGUvbGliL3J1bnRpbWUuanNcIik7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdGVtcGxhdGUobG9jYWxzKSB7XG52YXIgYnVmID0gW107XG52YXIgamFkZV9taXhpbnMgPSB7fTtcbnZhciBqYWRlX2ludGVycDtcbjt2YXIgbG9jYWxzX2Zvcl93aXRoID0gKGxvY2FscyB8fCB7fSk7KGZ1bmN0aW9uIChtb2RlbCkge1xuaWYgKCBtb2RlbC51cmwpXG57XG52YXIgYWx0ID0gbW9kZWwuYWx0O1xudmFyIHdpZHRoID0gbW9kZWwud2lkdGg7XG52YXIgaGVpZ2h0ID0gbW9kZWwuaGVpZ2h0O1xudmFyIGFzcGVjdCA9IG1vZGVsLndpZHRoIC8gbW9kZWwuaGVpZ2h0O1xudmFyIHBhZGRpbmcgPSBtb2RlbC5oZWlnaHQgLyBtb2RlbC53aWR0aCAqIDEwMDtcbnZhciB1cmwgPSBtb2RlbC51cmw7XG52YXIgdXJsU2V0ID0gbW9kZWwudXJsU2V0O1xuYnVmLnB1c2goXCI8ZmlndXJlXCIgKyAoamFkZS5hdHRyKFwic3R5bGVcIiwgd2lkdGggPyBcInBhZGRpbmctdG9wOiBcIiArIChwYWRkaW5nKSArIFwiJVwiIDogZmFsc2UsIHRydWUsIGZhbHNlKSkgKyAoamFkZS5jbHMoW1snaW1hZ2UtcmVzaXplcicsIHdpZHRoID8gJ2ltYWdlLXJlc2l6ZXItLXBsYWNlaG9sZGVyJyA6ICcnXV0sIFt0cnVlXSkpICsgXCI+PGltZ1wiICsgKGphZGUuYXR0cihcImFsdFwiLCBhbHQsIHRydWUsIGZhbHNlKSkgKyBcIiBzcmM9XFxcImh0dHA6Ly85bmV3cy5zdGF0aWM5Lm5ldC5hdS9Db250ZW50L2ltYWdlcy8xeDEuZ2lmXFxcIiBkYXRhLWltYWdlLXJlc2l6ZXI9XFxcImRhdGEtaW1hZ2UtcmVzaXplclxcXCJcIiArIChqYWRlLmF0dHIoXCJkYXRhLXNyYy1zZXRcIiwgdXJsU2V0LCB0cnVlLCBmYWxzZSkpICsgKGphZGUuYXR0cihcImRhdGEtYXNwZWN0XCIsIGFzcGVjdCwgdHJ1ZSwgZmFsc2UpKSArIFwiIGNsYXNzPVxcXCJpbWFnZS1yZXNpemVyX19pbWFnZVxcXCIvPjxub3NjcmlwdD48ZGl2IGNsYXNzPVxcXCJpbWFnZS1yZXNpemVyLS1ub2pzXFxcIj48aW1nXCIgKyAoamFkZS5hdHRyKFwiYWx0XCIsIGFsdCwgdHJ1ZSwgZmFsc2UpKSArIChqYWRlLmF0dHIoXCJzcmNcIiwgdXJsLCB0cnVlLCBmYWxzZSkpICsgXCIgZGF0YS1pbWFnZS1yZXNpemVyPVxcXCJkYXRhLWltYWdlLXJlc2l6ZXJcXFwiIGNsYXNzPVxcXCJpbWFnZS1yZXNpemVyX19pbWFnZSBpbWFnZS1yZXNpemVyX19pbWFnZS0tbm9qc1xcXCIvPjwvZGl2Pjwvbm9zY3JpcHQ+PC9maWd1cmU+XCIpO1xufX0uY2FsbCh0aGlzLFwibW9kZWxcIiBpbiBsb2NhbHNfZm9yX3dpdGg/bG9jYWxzX2Zvcl93aXRoLm1vZGVsOnR5cGVvZiBtb2RlbCE9PVwidW5kZWZpbmVkXCI/bW9kZWw6dW5kZWZpbmVkKSk7O3JldHVybiBidWYuam9pbihcIlwiKTtcbn1cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vc3JjL3RlbXBsYXRlcy9pbWFnZS1yZXNpemVyLmphZGVcbiAqKiBtb2R1bGUgaWQgPSA2XG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iLCIndXNlIHN0cmljdCc7XG5cbi8qKlxuICogTWVyZ2UgdHdvIGF0dHJpYnV0ZSBvYmplY3RzIGdpdmluZyBwcmVjZWRlbmNlXG4gKiB0byB2YWx1ZXMgaW4gb2JqZWN0IGBiYC4gQ2xhc3NlcyBhcmUgc3BlY2lhbC1jYXNlZFxuICogYWxsb3dpbmcgZm9yIGFycmF5cyBhbmQgbWVyZ2luZy9qb2luaW5nIGFwcHJvcHJpYXRlbHlcbiAqIHJlc3VsdGluZyBpbiBhIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gYVxuICogQHBhcmFtIHtPYmplY3R9IGJcbiAqIEByZXR1cm4ge09iamVjdH0gYVxuICogQGFwaSBwcml2YXRlXG4gKi9cblxuZXhwb3J0cy5tZXJnZSA9IGZ1bmN0aW9uIG1lcmdlKGEsIGIpIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICB2YXIgYXR0cnMgPSBhWzBdO1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYS5sZW5ndGg7IGkrKykge1xuICAgICAgYXR0cnMgPSBtZXJnZShhdHRycywgYVtpXSk7XG4gICAgfVxuICAgIHJldHVybiBhdHRycztcbiAgfVxuICB2YXIgYWMgPSBhWydjbGFzcyddO1xuICB2YXIgYmMgPSBiWydjbGFzcyddO1xuXG4gIGlmIChhYyB8fCBiYykge1xuICAgIGFjID0gYWMgfHwgW107XG4gICAgYmMgPSBiYyB8fCBbXTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoYWMpKSBhYyA9IFthY107XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGJjKSkgYmMgPSBbYmNdO1xuICAgIGFbJ2NsYXNzJ10gPSBhYy5jb25jYXQoYmMpLmZpbHRlcihudWxscyk7XG4gIH1cblxuICBmb3IgKHZhciBrZXkgaW4gYikge1xuICAgIGlmIChrZXkgIT0gJ2NsYXNzJykge1xuICAgICAgYVtrZXldID0gYltrZXldO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhO1xufTtcblxuLyoqXG4gKiBGaWx0ZXIgbnVsbCBgdmFsYHMuXG4gKlxuICogQHBhcmFtIHsqfSB2YWxcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuXG5mdW5jdGlvbiBudWxscyh2YWwpIHtcbiAgcmV0dXJuIHZhbCAhPSBudWxsICYmIHZhbCAhPT0gJyc7XG59XG5cbi8qKlxuICogam9pbiBhcnJheSBhcyBjbGFzc2VzLlxuICpcbiAqIEBwYXJhbSB7Kn0gdmFsXG4gKiBAcmV0dXJuIHtTdHJpbmd9XG4gKi9cbmV4cG9ydHMuam9pbkNsYXNzZXMgPSBqb2luQ2xhc3NlcztcbmZ1bmN0aW9uIGpvaW5DbGFzc2VzKHZhbCkge1xuICByZXR1cm4gKEFycmF5LmlzQXJyYXkodmFsKSA/IHZhbC5tYXAoam9pbkNsYXNzZXMpIDpcbiAgICAodmFsICYmIHR5cGVvZiB2YWwgPT09ICdvYmplY3QnKSA/IE9iamVjdC5rZXlzKHZhbCkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsgcmV0dXJuIHZhbFtrZXldOyB9KSA6XG4gICAgW3ZhbF0pLmZpbHRlcihudWxscykuam9pbignICcpO1xufVxuXG4vKipcbiAqIFJlbmRlciB0aGUgZ2l2ZW4gY2xhc3Nlcy5cbiAqXG4gKiBAcGFyYW0ge0FycmF5fSBjbGFzc2VzXG4gKiBAcGFyYW0ge0FycmF5LjxCb29sZWFuPn0gZXNjYXBlZFxuICogQHJldHVybiB7U3RyaW5nfVxuICovXG5leHBvcnRzLmNscyA9IGZ1bmN0aW9uIGNscyhjbGFzc2VzLCBlc2NhcGVkKSB7XG4gIHZhciBidWYgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGVzY2FwZWQgJiYgZXNjYXBlZFtpXSkge1xuICAgICAgYnVmLnB1c2goZXhwb3J0cy5lc2NhcGUoam9pbkNsYXNzZXMoW2NsYXNzZXNbaV1dKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBidWYucHVzaChqb2luQ2xhc3NlcyhjbGFzc2VzW2ldKSk7XG4gICAgfVxuICB9XG4gIHZhciB0ZXh0ID0gam9pbkNsYXNzZXMoYnVmKTtcbiAgaWYgKHRleHQubGVuZ3RoKSB7XG4gICAgcmV0dXJuICcgY2xhc3M9XCInICsgdGV4dCArICdcIic7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG59O1xuXG5cbmV4cG9ydHMuc3R5bGUgPSBmdW5jdGlvbiAodmFsKSB7XG4gIGlmICh2YWwgJiYgdHlwZW9mIHZhbCA9PT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXModmFsKS5tYXAoZnVuY3Rpb24gKHN0eWxlKSB7XG4gICAgICByZXR1cm4gc3R5bGUgKyAnOicgKyB2YWxbc3R5bGVdO1xuICAgIH0pLmpvaW4oJzsnKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdmFsO1xuICB9XG59O1xuLyoqXG4gKiBSZW5kZXIgdGhlIGdpdmVuIGF0dHJpYnV0ZS5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30ga2V5XG4gKiBAcGFyYW0ge1N0cmluZ30gdmFsXG4gKiBAcGFyYW0ge0Jvb2xlYW59IGVzY2FwZWRcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gdGVyc2VcbiAqIEByZXR1cm4ge1N0cmluZ31cbiAqL1xuZXhwb3J0cy5hdHRyID0gZnVuY3Rpb24gYXR0cihrZXksIHZhbCwgZXNjYXBlZCwgdGVyc2UpIHtcbiAgaWYgKGtleSA9PT0gJ3N0eWxlJykge1xuICAgIHZhbCA9IGV4cG9ydHMuc3R5bGUodmFsKTtcbiAgfVxuICBpZiAoJ2Jvb2xlYW4nID09IHR5cGVvZiB2YWwgfHwgbnVsbCA9PSB2YWwpIHtcbiAgICBpZiAodmFsKSB7XG4gICAgICByZXR1cm4gJyAnICsgKHRlcnNlID8ga2V5IDoga2V5ICsgJz1cIicgKyBrZXkgKyAnXCInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgfSBlbHNlIGlmICgwID09IGtleS5pbmRleE9mKCdkYXRhJykgJiYgJ3N0cmluZycgIT0gdHlwZW9mIHZhbCkge1xuICAgIGlmIChKU09OLnN0cmluZ2lmeSh2YWwpLmluZGV4T2YoJyYnKSAhPT0gLTEpIHtcbiAgICAgIGNvbnNvbGUud2FybignU2luY2UgSmFkZSAyLjAuMCwgYW1wZXJzYW5kcyAoYCZgKSBpbiBkYXRhIGF0dHJpYnV0ZXMgJyArXG4gICAgICAgICAgICAgICAgICAgJ3dpbGwgYmUgZXNjYXBlZCB0byBgJmFtcDtgJyk7XG4gICAgfTtcbiAgICBpZiAodmFsICYmIHR5cGVvZiB2YWwudG9JU09TdHJpbmcgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNvbnNvbGUud2FybignSmFkZSB3aWxsIGVsaW1pbmF0ZSB0aGUgZG91YmxlIHF1b3RlcyBhcm91bmQgZGF0ZXMgaW4gJyArXG4gICAgICAgICAgICAgICAgICAgJ0lTTyBmb3JtIGFmdGVyIDIuMC4wJyk7XG4gICAgfVxuICAgIHJldHVybiAnICcgKyBrZXkgKyBcIj0nXCIgKyBKU09OLnN0cmluZ2lmeSh2YWwpLnJlcGxhY2UoLycvZywgJyZhcG9zOycpICsgXCInXCI7XG4gIH0gZWxzZSBpZiAoZXNjYXBlZCkge1xuICAgIGlmICh2YWwgJiYgdHlwZW9mIHZhbC50b0lTT1N0cmluZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29uc29sZS53YXJuKCdKYWRlIHdpbGwgc3RyaW5naWZ5IGRhdGVzIGluIElTTyBmb3JtIGFmdGVyIDIuMC4wJyk7XG4gICAgfVxuICAgIHJldHVybiAnICcgKyBrZXkgKyAnPVwiJyArIGV4cG9ydHMuZXNjYXBlKHZhbCkgKyAnXCInO1xuICB9IGVsc2Uge1xuICAgIGlmICh2YWwgJiYgdHlwZW9mIHZhbC50b0lTT1N0cmluZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29uc29sZS53YXJuKCdKYWRlIHdpbGwgc3RyaW5naWZ5IGRhdGVzIGluIElTTyBmb3JtIGFmdGVyIDIuMC4wJyk7XG4gICAgfVxuICAgIHJldHVybiAnICcgKyBrZXkgKyAnPVwiJyArIHZhbCArICdcIic7XG4gIH1cbn07XG5cbi8qKlxuICogUmVuZGVyIHRoZSBnaXZlbiBhdHRyaWJ1dGVzIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqXG4gKiBAcGFyYW0ge09iamVjdH0gZXNjYXBlZFxuICogQHJldHVybiB7U3RyaW5nfVxuICovXG5leHBvcnRzLmF0dHJzID0gZnVuY3Rpb24gYXR0cnMob2JqLCB0ZXJzZSl7XG4gIHZhciBidWYgPSBbXTtcblxuICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iaik7XG5cbiAgaWYgKGtleXMubGVuZ3RoKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIga2V5ID0ga2V5c1tpXVxuICAgICAgICAsIHZhbCA9IG9ialtrZXldO1xuXG4gICAgICBpZiAoJ2NsYXNzJyA9PSBrZXkpIHtcbiAgICAgICAgaWYgKHZhbCA9IGpvaW5DbGFzc2VzKHZhbCkpIHtcbiAgICAgICAgICBidWYucHVzaCgnICcgKyBrZXkgKyAnPVwiJyArIHZhbCArICdcIicpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBidWYucHVzaChleHBvcnRzLmF0dHIoa2V5LCB2YWwsIGZhbHNlLCB0ZXJzZSkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBidWYuam9pbignJyk7XG59O1xuXG4vKipcbiAqIEVzY2FwZSB0aGUgZ2l2ZW4gc3RyaW5nIG9mIGBodG1sYC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gaHRtbFxuICogQHJldHVybiB7U3RyaW5nfVxuICogQGFwaSBwcml2YXRlXG4gKi9cblxudmFyIGphZGVfZW5jb2RlX2h0bWxfcnVsZXMgPSB7XG4gICcmJzogJyZhbXA7JyxcbiAgJzwnOiAnJmx0OycsXG4gICc+JzogJyZndDsnLFxuICAnXCInOiAnJnF1b3Q7J1xufTtcbnZhciBqYWRlX21hdGNoX2h0bWwgPSAvWyY8PlwiXS9nO1xuXG5mdW5jdGlvbiBqYWRlX2VuY29kZV9jaGFyKGMpIHtcbiAgcmV0dXJuIGphZGVfZW5jb2RlX2h0bWxfcnVsZXNbY10gfHwgYztcbn1cblxuZXhwb3J0cy5lc2NhcGUgPSBqYWRlX2VzY2FwZTtcbmZ1bmN0aW9uIGphZGVfZXNjYXBlKGh0bWwpe1xuICB2YXIgcmVzdWx0ID0gU3RyaW5nKGh0bWwpLnJlcGxhY2UoamFkZV9tYXRjaF9odG1sLCBqYWRlX2VuY29kZV9jaGFyKTtcbiAgaWYgKHJlc3VsdCA9PT0gJycgKyBodG1sKSByZXR1cm4gaHRtbDtcbiAgZWxzZSByZXR1cm4gcmVzdWx0O1xufTtcblxuLyoqXG4gKiBSZS10aHJvdyB0aGUgZ2l2ZW4gYGVycmAgaW4gY29udGV4dCB0byB0aGVcbiAqIHRoZSBqYWRlIGluIGBmaWxlbmFtZWAgYXQgdGhlIGdpdmVuIGBsaW5lbm9gLlxuICpcbiAqIEBwYXJhbSB7RXJyb3J9IGVyclxuICogQHBhcmFtIHtTdHJpbmd9IGZpbGVuYW1lXG4gKiBAcGFyYW0ge1N0cmluZ30gbGluZW5vXG4gKiBAYXBpIHByaXZhdGVcbiAqL1xuXG5leHBvcnRzLnJldGhyb3cgPSBmdW5jdGlvbiByZXRocm93KGVyciwgZmlsZW5hbWUsIGxpbmVubywgc3RyKXtcbiAgaWYgKCEoZXJyIGluc3RhbmNlb2YgRXJyb3IpKSB0aHJvdyBlcnI7XG4gIGlmICgodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyB8fCAhZmlsZW5hbWUpICYmICFzdHIpIHtcbiAgICBlcnIubWVzc2FnZSArPSAnIG9uIGxpbmUgJyArIGxpbmVubztcbiAgICB0aHJvdyBlcnI7XG4gIH1cbiAgdHJ5IHtcbiAgICBzdHIgPSBzdHIgfHwgcmVxdWlyZSgnZnMnKS5yZWFkRmlsZVN5bmMoZmlsZW5hbWUsICd1dGY4JylcbiAgfSBjYXRjaCAoZXgpIHtcbiAgICByZXRocm93KGVyciwgbnVsbCwgbGluZW5vKVxuICB9XG4gIHZhciBjb250ZXh0ID0gM1xuICAgICwgbGluZXMgPSBzdHIuc3BsaXQoJ1xcbicpXG4gICAgLCBzdGFydCA9IE1hdGgubWF4KGxpbmVubyAtIGNvbnRleHQsIDApXG4gICAgLCBlbmQgPSBNYXRoLm1pbihsaW5lcy5sZW5ndGgsIGxpbmVubyArIGNvbnRleHQpO1xuXG4gIC8vIEVycm9yIGNvbnRleHRcbiAgdmFyIGNvbnRleHQgPSBsaW5lcy5zbGljZShzdGFydCwgZW5kKS5tYXAoZnVuY3Rpb24obGluZSwgaSl7XG4gICAgdmFyIGN1cnIgPSBpICsgc3RhcnQgKyAxO1xuICAgIHJldHVybiAoY3VyciA9PSBsaW5lbm8gPyAnICA+ICcgOiAnICAgICcpXG4gICAgICArIGN1cnJcbiAgICAgICsgJ3wgJ1xuICAgICAgKyBsaW5lO1xuICB9KS5qb2luKCdcXG4nKTtcblxuICAvLyBBbHRlciBleGNlcHRpb24gbWVzc2FnZVxuICBlcnIucGF0aCA9IGZpbGVuYW1lO1xuICBlcnIubWVzc2FnZSA9IChmaWxlbmFtZSB8fCAnSmFkZScpICsgJzonICsgbGluZW5vXG4gICAgKyAnXFxuJyArIGNvbnRleHQgKyAnXFxuXFxuJyArIGVyci5tZXNzYWdlO1xuICB0aHJvdyBlcnI7XG59O1xuXG5leHBvcnRzLkRlYnVnSXRlbSA9IGZ1bmN0aW9uIERlYnVnSXRlbShsaW5lbm8sIGZpbGVuYW1lKSB7XG4gIHRoaXMubGluZW5vID0gbGluZW5vO1xuICB0aGlzLmZpbGVuYW1lID0gZmlsZW5hbWU7XG59XG5cblxuXG4vKioqKioqKioqKioqKioqKipcbiAqKiBXRUJQQUNLIEZPT1RFUlxuICoqIC4vfi9qYWRlL2xpYi9ydW50aW1lLmpzXG4gKiogbW9kdWxlIGlkID0gN1xuICoqIG1vZHVsZSBjaHVua3MgPSAwXG4gKiovIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiZnNcIik7XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiBleHRlcm5hbCBcImZzXCJcbiAqKiBtb2R1bGUgaWQgPSA4XG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iXSwic291cmNlUm9vdCI6IiJ9