lodash = require 'lodash'
webpack = require 'webpack'
webpackExternals = require 'mi9-externals-webpack'
webpackStats = require 'stats-webpack-plugin'

webpackBaseConfig =
    target: 'node'
    devtool: 'inline-source-map'
    output:
        path: 'build'
        filename: '[name].js'
        pathinfo: true
        libraryTarget: 'commonjs2'
        devtoolModuleFilenameTemplate: 'webpack:///node_modules/mi9-article/[resource-path]'
    module:
        preLoaders: [
            test: /mi9(.*)\.js$/
            loader: 'source-map'
        ,
            test: /\.coffee$/
            loader: 'coffeelint'
        ]
        loaders: [
            test: /\.coffee$/
            loader: 'coffee'
        ,
            test: /\.jade$/
            loader: 'jade'
        ]
    externals: webpackExternals 'node_modules'
    resolve:
        root: process.cwd()
        extensions: [
            ''
            '.js'
            '.coffee'
            '.jade'
        ]

webpackModuleConfig = lodash.cloneDeep webpackBaseConfig
webpackModuleConfig.entry =
    'lib/module': 'src/scripts/index'
webpackModuleConfig.plugins = [
    new webpackStats 'lib/webpack-stats.json'
]

webpackTestsConfig = lodash.cloneDeep webpackBaseConfig
webpackTestsConfig.entry =
    'tests/helper': 'src/tests/helper.coffee'
    'tests/article.spec': 'src/tests/article.spec.coffee'

module.exports = [webpackModuleConfig, webpackTestsConfig]
