## Route Class

Note: The words router / controller would be used interchangeably


##### Reference directory structure

```
|_project/
  |_routes/
    |_gallery.coffee
    |_insta-celeb.coffee
  |_router.coffee
  |_app.coffee

```

###### Gallery Route - `gallery.coffee`

##### Class based routes

```coffee

Route = require 'mi9-route'

class Gallery extends Route
    render: ->
        @res.send '<h1>Welcome to the gallery</h1>'

module.exports = Gallery

```

All routes should implement the entry point render method. 
Optionally an init method could be used which would act just like a constructor

```coffee

Route = require 'mi9-route'

class Home extends Route
    init: ->
        @settings = @res.locals.settings
    viewModel: ->
        return {view: @settings}
    render: ->
        @res.json @viewModel()

module.exports = Home

```
The routes are regular classes with extras. 
The routes can be used inside another module using the `new MyRoute()` construct. 

Using the class as `MyRoute.asRoute()` wraps your class as an express middleware. 

So, you could simply use the class directly in your router / controller. 

```coffee
router = require('express').Router()
Home = require './routes/home'

router.get '/', Home.asRoute()

module.exports = router
```

The `MyRoute.asRoute()` construct doesn't expect any arguments and hence the init method won't receive any params, but the req, res and next would be available as instance variables. However when using the `new MyRoute(arg)` construct you get the arguments passed to the init method as expected. The `render` method gets called only when an instance is a route. 

```coffee
Route = require 'mi9-route'

class Gallery extends Route
    init: (id) ->
        @id = if @isRoute() then req.params.id else id
    viewModel: ->
        data = @getData()
        return {view: data}
    render: ->
        @res.json @viewModel()

module.exports = Gallery

```

Usage inside another module

```coffee
gallery = new Gallery(id)
galleryModel = gallery.viewModel()

```

Usage as a route

```coffee
app.get '/gallery/:id', Gallery.asRoute()

```

## Template Helper Class

### Rendering templates

The `mi9-route` modules comes inbuilt with the template helper module. 
Extending from the `Route` class adds all the template helpers into the subclass. 

```coffee
Route = require 'mi9-route'

class MyRoute extends Route
    init: ->
        @registerTemplates({
            templateOne: {
                path: __dirname + '/mytemplate1'
                baseDir: __dirname
            }
        })
    viewModel: ->
        model = {
            view: renderTemplate('templateOne', {content: '<html/>'})
        }
    render: ->
        @res.render 'page', @viewModel()
```

The template helpers can also available to be used independently

```coffee
{TemplateHelper} = require 'mi9-route'

template = new TemplateHelper()

template.registerTemplates({
    templateOne: {
        path: __dirname + '/mytemplate1'
        baseDir: __dirname
    }
    templateTwo: {
        path: __dirname + '/mytemplate2'
        baseDir: __dirname
    }
})

# Render the template
one = template.renderTemplate('templateOne', {view: '<html/>'})
two = template.renderTemplate('templateTwo', {view: '<html/>'})

```

### Rendering partials

```coffee
template = new TemplateHelper()

template.registerPartials({
    partialOne: {
        path: __dirname + '/path/file1.jade'
        baseDir: __dirname
    }
    partialTwo: {
        path: __dirname + '/path/file2.jade'
        baseDir: __dirname
    }
})

# Render the template
one = template.renderPartial('partialOne', {view: '<html/>'})
two = template.renderPartial('partialTwo', {view: '<html/>'})

```

##### Jade usage
Register the partial as above and use inside a template

`file: main.jade`
```jade
body
    != includePartial('partialOne', {from: 'Master'})
```

`file: partials/partial.jade`
```jade
<div>#{from} says: I am a partial</div>
```

```coffee
template = new TemplateHelper()

template.registerTemplates({
    templateOne: {
        path: __dirname + '/main.jade'
        baseDir: __dirname
    }
})

template.registerPartials({
    partialOne: {
        path: __dirname + '/partials/partial.jade'
        baseDir: __dirname
    }
})

html = template.renderTemplate('templateOne', {view: '<html/>'})
```

## Shortcuts - Helper functions

### templateConfig - create a template configuration object

```coffee
{shortcuts} = require 'mi9-route'

config = shortcuts.templateConfig('abc', '/root')
# returns the config as below
# {
#     path: '/root/abc.jade'
#     baseDir: '/root'
# }

```

Create the templates configuration object using the config helper

`file: templates.coffee`

```coffee
{shortcuts} = require 'mi9-route'
baseDir = __dirname + '/markups'

module.exports =
    partials:
        'partial': shortcuts.templateConfig('partials/partial', baseDir)
    templates:
        'template': shortcuts.templateConfig('template', baseDir)

### exports looks like
{
    partials: {
        partial: {
            path: '/somedir/markups/partials/partial.jade'
            baseDir: '/somedir/markups'
        }
    }

    templates: {
        template: {
            path: '/somedir/markups/template.jade'
            baseDir: '/somedir/markups'
        }
    }
}
###
```

And use inside the route subclass
`file: my-route.coffee`

```coffee
Route  = require 'mi9-route'
templates = require './templates'

class MyRoute extends Route
    init: ->
        @registerPartials(templates.partials)
        @registerTemplates(templates.templates)

    render: ->
        html = @renderPartial('partial', {})
        html += @renderTemplate('template', {})
        @res.send html
```

Create an extended configuration object

`file: templates.coffee`
```coffee
{shortcuts} = require 'mi9-route'
baseDir = __dirname + '/markups'

module.exports =
    templates:
        'template': shortcuts.templateConfig('new-template', baseDir, {extended: true})

```
