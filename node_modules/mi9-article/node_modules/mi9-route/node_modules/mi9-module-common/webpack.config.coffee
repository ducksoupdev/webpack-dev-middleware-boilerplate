lodash = require 'lodash'
webpack = require 'webpack'
webpackStats = require 'stats-webpack-plugin'

webpackBaseConfig =
    devtool: 'inline-source-map'
    output:
        path: 'build'
        filename: '[name].js'
        pathinfo: true
        libraryTarget: 'umd'
    module:
        preLoaders: [
            test: /\.coffee$/
            loader: 'coffeelint'
        ]
        loaders: [
            test: /\.coffee$/
            loader: 'coffee'
        ]
    resolve:
        root: process.cwd()
        extensions: [
            ''
            '.coffee'
        ]

webpackModuleClientConfig = lodash.cloneDeep webpackBaseConfig
webpackModuleClientConfig.entry =
    'lib/client/module': 'src/scripts/index'
webpackModuleClientConfig.output.libraryTarget = 'umd'
webpackModuleClientConfig.output.devtoolModuleFilenameTemplate = 'webpack:///bower_components/mi9-module-common/[resource-path]'
webpackModuleClientConfig.plugins = [
    new webpackStats 'lib/webpack-stats.json'
]

webpackModuleServerConfig = lodash.cloneDeep webpackBaseConfig
webpackModuleServerConfig.entry =
    'lib/server/module': 'src/scripts/index'
webpackModuleServerConfig.output.libraryTarget = 'commonjs2'
webpackModuleServerConfig.output.devtoolModuleFilenameTemplate = 'webpack:///node_modules/mi9-module-common/[resource-path]'

webpackTestsConfig = lodash.cloneDeep webpackBaseConfig
webpackTestsConfig.entry =
    'tests/dependency-injector.spec': 'src/tests/dependency-injector.spec'
    'tests/mixin.spec': 'src/tests/mixin.spec'
webpackModuleServerConfig.output.libraryTarget = 'commonjs2'
webpackModuleServerConfig.output.devtoolModuleFilenameTemplate = 'webpack:///node_modules/mi9-module-common/[resource-path]'

module.exports = [webpackModuleClientConfig, webpackModuleServerConfig, webpackTestsConfig]