### Using the environment module
`file: myApp/mainApp.coffee`

```coffee
# step 1 - Setup the environment
environment = require 'mi9-environment'
    .setup
        appConfigPath: "#{__dirname}/env"

# step 2 - Load other dependencies
sitecoreClient = require 'mi9-sitecoreclient'
```

Your app setup may look something like this

```
myApp/
    env/
        default.coffee
        development.coffee
        staging.coffee
        production.coffee
    node_modules/
        mi9-environment
        mi9-sitecore
    mainApp.coffee
```

###### setup method options
`environment.setup(options)`

* options.appConfigPath
    > Absolute path to the app environment configuration directory
    >
    > The path may contain development/production/staging .js|.coffee|.json configuration files
    > The corresponding config would be loaded based on the system `APP_ENV` variable
    > usage: `appConfigPath: "#{__dirname}/conf/path"`

* options.appConfigExtn
    > Optional setting - By default the config is assumed to be a .js or .coffee script file
    >
    > This option can be used to use a `.json` extension instead
    > usage: `appConfigExtn: 'json'`

The environment setup looks for the `APP_ENV` variable or else fallsback to a local environment
> 1. APP_ENV (system environment variable)
> 2. LOCAL_APP_ENVIRONMENT - `development`

### Application specific configurations
###### Environment specific app config files
- myApp/env/development.coffee
- myApp/env/production.coffee
- myApp/env/staging.coffee
- myApp/env/default.coffee

`file: myApp/env/default.coffee`

```coffee
module.exports =
    config:
        sitename: 'thefix'
```

`file: myApp/env/development.coffee`

```coffee
module.exports =
    config:
        server: 'http://content.api.uat.ninemsn.com.au'
```

`file: myApp/env/production.coffee`

```coffee
module.exports =
    config:
        server: 'http://content.api.ninemsn.com.au'
```
default.coffee contains base config. Most config exists within here. [envName].coffee contains overrides for that environment.  
**Note: If the value in [envName].coffee is undefined, it will not override default.coffee**
### Specs
- it 'throws error if `default` does not exist'
- it 'returns the value from default if no environment specified and development.coffee is missing'
- it 'throws error if the system environment `APP_ENV` could not be resolved as a valid configuration and `APP_ENV` is not `development`'
- it 'returns the value from default if [envName].coffee does not overwrite'
- it 'return the value from [envName].coffee if [envName].coffee overwrites default.coffee'
### Accessing environment settings
###### Accessor (Preferred way)
```coffee
ninemsnServer = environment.get 'config:server'
```

###### Local copy
```coffee
appConfig = environment.get()
ninemsnServer= appConfig.config.server
```

### Controlling the application environment setting using the `APP_ENV` environment variable

> ###### Volatile `APP_ENV`
> - `APP_ENV=production coffee mainApp.coffee`
>
> This causes the setup to load the `myApp/env/production.(coffee|js|json)` configuration

> ###### Persistent `APP_ENV`
> Setting a user-wide `APP_ENV` environment variable in the server avoids the need for any additional execution arguments
>
> Unix - inside startup scripts like .bashrc / .profile
> ```shell
> export APP_ENV="production"
> ```
>
> Windows power shell
> ```
> [Environment]::SetEnvironmentVariable("APP_ENV","production","User")
> ```

### Overriding particular settings just locally
If you want to take the default configuration (that is, config set be `APP_ENV`) but override only a particular key/value pair, 
you can set that as an environment variable. The variable name should be the key used to access that config, with colons replaced
with underscores.

For example, if have something like the following

```coffee
config = http.get(environment.get('server:configUrl'))
```

You would override that locally by setting the environment variable `server_configUrl`:

```
export server_configUrl
```

### Accessing system environment variables
Node stores environment variables values as `string`. This often leads to issues in truthiness checks
eg. 

```coffee
process.env['NEW_RELIC_ENABLED'] = false

```
would return `false` as string `'false'` causing a check like 

```coffee
if process.env['NEW_RELIC_ENABLED']
   # always true, unless the system variable NEW_RELIC_ENABLED itself is not declared

```

Use `environment.sys` instead and to make it work as expected 
```coffee
console.log 'New relic enabled' if environment.sys 'NEW_RELIC_ENABLED'
```
`environment.sys` would parse number, json or boolean values into javascript types.

The raw values are always accessible through process.env
